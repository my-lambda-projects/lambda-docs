Please enable JavaScript to view this page.

You must be logged in to view this page.

You must be a Lambda School student to view this page.

<a href="#content" id="skippy" class="sr-only sr-only-focusable"></a>

<span class="skiplink-text">Skip to main content</span>

<a href="/" class="navbar-brand"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMyIgaGVpZ2h0PSIzNSIgdmlld2JveD0iMCAwIDMzIDM1IiBmaWxsPSJub25lIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0wIDBWMTYuMDYwOUMwIDI3LjczMzUgOS4wODkyOSAzMS43ODQzIDE1LjczMjEgMzQuNzUxM0gxNS43NUwxNi4yODU3IDM1QzE2LjQxMDcgMzQuOTI4OSAxNi41MzU3IDM0Ljg3NTYgMTYuNjc4NiAzNC44MjIzQzE2Ljc1IDM0Ljc4NjggMTYuODM5MyAzNC43NTEzIDE2LjkxMDcgMzQuNzE1N0MyMy41NzE0IDMxLjc2NjUgMzIuNjk2NCAyNy42OTggMzIuNjk2NCAxNi4wNjA5VjBIMFpNMjAuNzA3MSAyMy40NTM2TDIwLjM1NzEgMjIuNTEwMkwxNS42MDcxIDEwLjA3MzZDMTUuMzIxNCAxMC44MDIgMTQuNjYwNyAxMi41NjA5IDEzLjk0NjQgMTQuNDQ0MkwxMS4yMTQzIDIxLjc4MTdDMTEuMDg5MyAyMi4xMzcxIDExLjE2MDcgMjIuMzE0NyAxMS4yNSAyMi40MzkxQzExLjQ0NjQgMjIuNjcwMSAxMS44NzY4IDIyLjY3MDEgMTIuNTU1NCAyMi42NzAxSDEyLjY3ODZMMTIuNjc2OCAyMy40NTE4SDcuNTY5NjRWMjIuNjcwMUg3Ljk2MjVDOC42NTg5MyAyMi42NzAxIDkuMjMwMzYgMjIuMzY4IDkuNjU4OTMgMjEuNTE1MkwxMC4xNzY4IDIwLjM0MjZMMTQuOTA4OSA4LjI5Njk2TDE0LjA2OTYgNi4wNzYxNEgxOC40ODA0TDI0LjU2OTYgMjIuMDEyN0wyNS4xMjUgMjMuNDUzNkgyMC43MDcxWiIgZmlsbD0iI0VDMzk0NCI+PC9wYXRoPgo8L3N2Zz4=" /></a>

![](data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdib3g9IjAgMCAzMCAzMCIgd2lkdGg9IjMwIiBoZWlnaHQ9IjMwIiBmb2N1c2FibGU9ImZhbHNlIj48dGl0bGU+TWVudTwvdGl0bGU+PHBhdGggc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNNCA3aDIyTTQgMTVoMjJNNCAyM2gyMiI+PC9wYXRoPjwvc3ZnPg==)

#### Computer Science Annex

<a href="/csannex/sprint/recMPt6jmsCgaqrfj" class="bd-toc-link">1.  Data Structures: Heaps</a>

-   [Heaps](/csannex/module/recNbOiLfM7bfQ0aE/)

<a href="/csannex/sprint/recKzV5STy8vYnbQ1" class="bd-toc-link">2.  Intro to Django</a>

-   [Django basics and setup](/csannex/module/recvCvXoZKm5cYOc4/)
-   [Building APIs](/csannex/module/recuEEEsf9eXphxy0/)

<a href="/csannex/sprint/recUHGX7arXkBIutr" class="bd-toc-link">3.  Python/Django I</a>

-   [Getting started with Python and Django](/csannex/module/rec4yg0hRHaeOmBGN/)
-   [Object-Oriented Programming](/csannex/module/recHhVqI4Y3j6UgLa/)
-   [Software Design Patterns](/csannex/module/recgVHqW0RShuQn1Z/)

<a href="/csannex/sprint/rec64nbdwB28JM7Qu" class="bd-toc-link">4.  Python/Django II/Career Development</a>

-   [REST](/csannex/module/rec7YHjLuXabdlhof/)
-   [GraphQL](/csannex/module/recjIPIwz5Pn5WbPh/)
-   [Model-View-Controller](/csannex/module/recVsikSMFoQ25WZd/)

<a href="/csannex/sprint/reczMSFEG5pffpADx" class="bd-toc-link">5.  Python/Django III/Career Development</a>

-   [Object-relational mapping](/csannex/module/reccrn1If8mhlIymc/)
-   [Relational Databases](/csannex/module/recU6Q1DLISGvt0dk/)

<a href="/csannex/sprint/recTTpwFpgZXtPG2o" class="bd-toc-link">6.  Project Week: Cellular Automata</a>

-   [Game of Life](/csannex/module/rec42j1bkTmC0Hsro/)

<a href="/csannex/sprint/recqkHjNcXzK5DTqd" class="bd-toc-link">7.  C Programming Topics</a>

-   [Introduction To C](/csannex/module/recLymrrD7f46rdBa/)
-   [Processes and System Calls](/csannex/module/rec7YmMV7ukDLK770/)
-   [Scheduling](/csannex/module/recfiYtQDLFXGOBFA/)
-   [Operating Systems](/csannex/module/recHPT5QiPS6NOCgz/)
-   [Web Server I](/csannex/module/recz76g3pcHs88Dax/)
-   [Web Server II](/csannex/module/recFGnBVmKCyR0427/)
-   [Theory of Computation](/csannex/module/recH0OAnSr6ZcnZ7F/)

<a href="/" class="navbar-brand"><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTM1IiBoZWlnaHQ9IjM1IiB2aWV3Ym94PSIwIDAgNzU2IDE5NyIgZmlsbD0iI2VjMzk0NCI+PGc+PHBhdGggZD0iTTI5Mi45LDEyNi42aC02LjdjLTksMC0xMi42LTEuOS0xMi42LTkuNVY0OC41YzAtNy43LDEuNi04LjYsMTEuNC05Ljd2LTQuNWgtNDEuM3Y0LjUgYzkuOCwxLjEsMTEuNCwxLjksMTEuNCw5Ljd2NjkuM2MwLDcuNy0xLjYsOC42LTExLjQsOS43djQuNWg3My43bDQuOS0yOS40aC00LjRDMzA4LjUsMTE5LjYsMzAzLjksMTI2LjYsMjkyLjksMTI2LjZ6Ij48L3BhdGg+PHBhdGggZD0iTTM4NS41LDEyMS4xVjc5LjNjMC0xNS44LTkuNC0yMi40LTI2LjYtMjIuNGMtMTUsMC0yNi44LDYuNi0yNi44LDE5LjNjMCwyLjQsMC4yLDMuMywwLjgsNWgxNi42IGMtMC41LTItMC43LTUtMC43LTcuNWMwLTkuNiwzLjYtMTIuNCw5LjQtMTIuNGM2LjQsMCw5LjcsMiw5LjcsMTQuNHYxMS4ybC0yMC44LDcuN2MtMTAuNiw0LjEtMTkuMyw4LjgtMTkuMywyMC43IGMwLDEwLjksNy41LDE3LjgsMTguNiwxNy44YzkuOSwwLDE3LjQtNi4yLDIxLjktMTIuMWwwLjEtMC4xbDAsMFYxMzJoMjZ2LTQuNEMzODcuNywxMjcuMSwzODUuNSwxMjYuMiwzODUuNSwxMjEuMXogTTM2OCwxMTcuOCBjLTQuNCwzLjMtNy42LDUuMy0xMiw1LjRjLTcuNywwLTExLjItNS4yLTExLjItMTIuNmMwLTcuNywzLjYtMTEuMiw5LjgtMTMuNWwxMy40LTUuNFYxMTcuOEwzNjgsMTE3Ljh6Ij48L3BhdGg+PHBhdGggZD0iTTUxNC40LDEyMVY3OS41YzAtMTQuOC02LTIyLjQtMTguNy0yMi40Yy0xMS41LDAtMTkuNCw2LjYtMjUuNSwxMy45Yy0xLjgtOS42LTcuNy0xMy45LTE3LjgtMTMuOSBjLTExLjQsMC0xOC43LDYuMi0yNC44LDEzLjZWNTdoLTIuM2wtMjMuOCw3LjR2Mi40bDguNiw1djQ5LjRjMCw1LTIuMSw2LjEtOC45LDYuNHY0LjRoMzUuMXYtNC40Yy02LjctMC4zLTguNy0xLjMtOC43LTYuNHYtNDcgYzQuNy0zLjYsOS41LTYuNSwxNS41LTYuNWM3LjYsMCwxMC41LDQuMiwxMC41LDEyLjd2NDAuOGMwLDUtMS45LDYuMS04LjcsNi40djQuNGwzNC44LDB2LTQuNGMtNi43LTAuMy04LjYtMS4zLTguNi02LjR2LTQ3IGM0LjctMy42LDkuNS02LjUsMTUuNS02LjVjNy42LDAsMTAuNSw0LjIsMTAuNSwxMi43bC0wLjEsNDAuNWMwLDUtMS44LDYuNC04LjYsNi43bDAsNC40aDM1LjF2LTQuNCBDNTE2LjcsMTI3LjQsNTE0LjQsMTI2LjEsNTE0LjQsMTIxeiI+PC9wYXRoPjxwYXRoIGQ9Ik01NzMuMiw1Ny4zYy0xMSwwLTE4LjUsNS43LTIzLjQsMTIuOFYyMi45aC0yLjdsLTIzLjQsNi44djIuNWw4LjYsNC41VjEzMmgyLjlsOC0zLjVjNS44LDMuMywxMi4zLDUsMjAuMiw1IGMyMC44LDAsMzcuNC0xNS44LDM3LjQtNDIuNkM2MDAuOSw2OS45LDU5MC40LDU3LjMsNTczLjIsNTcuM3ogTTU2My40LDEyOC43Yy01LjQsMC0xMC4zLTIuNC0xMy43LTcuOVY3My42IGMzLjQtMy40LDguNS01LjcsMTMuNS01LjdjMTMuOSwwLDIwLDEyLjgsMjAsMjkuNUM1ODMuMywxMTQuNyw1NzUuOCwxMjguNSw1NjMuNCwxMjguN3oiPjwvcGF0aD48cGF0aCBkPSJNNjc3LDEyMS4yVjIyLjhoLTIuNkw2NTEsMjkuNlYzMmw4LjYsNC41djI1LjdjLTMuNC0zLjItOC44LTUuMS0xNS41LTUuMWMtMTkuOSwwLTM1LjIsMTUuMy0zNS4yLDQxLjMgYzAsMjAuNywxMS4yLDM0LjYsMjguMSwzNC42YzkuOCwwLDE3LTUuMywyMi42LTEzLjF2MC45VjEzMmgyNi4zbDAtNC40QzY3OS4xLDEyNy4zLDY3NywxMjYuMyw2NzcsMTIxLjJ6IE02NTkuNiwxMTcuMSBMNjU5LjYsMTE3LjFjLTMuNCwzLjQtOCw1LjEtMTMuMiw1LjFjLTEzLjIsMC0yMC40LTEyLjgtMjAuNC0yOS44YzAtMTcuOCw3LjMtMjkuMiwxOS41LTI5LjJjOC43LDAsMTQuMSw2LjksMTQuMSwxOC4zIEw2NTkuNiwxMTcuMXoiPjwvcGF0aD48cGF0aCBkPSJNNzQ3LjEsMTIxLjFWNzkuM2MwLTE1LjgtOS40LTIyLjQtMjYuNi0yMi40Yy0xNSwwLTI2LjgsNi42LTI2LjgsMTkuM2MwLDIuNCwwLjIsMy4zLDAuOCw1aDE2LjYgYy0wLjUtMi0wLjctNS0wLjctNy41YzAtOS42LDMuNi0xMi40LDkuNC0xMi40YzYuNCwwLDkuNywyLDkuNywxNC40djExLjJsLTIwLjgsNy43Yy0xMC42LDQuMS0xOS4zLDguOC0xOS4zLDIwLjcgYzAsMTAuOSw3LjUsMTcuOCwxOC42LDE3LjhjOS45LDAsMTcuNC02LjIsMjEuOS0xMi4xdi0wLjFoMC4xbDAsMTEuMWwyNiwwLjF2LTQuNUM3NDkuMywxMjcuMSw3NDcuMSwxMjYuMiw3NDcuMSwxMjEuMXogTTcyOS42LDExNy44Yy00LjQsMy4zLTcuNiw1LjMtMTIuMSw1LjRjLTcuNywwLTExLjItNS4yLTExLjItMTIuNmMwLTcuNywzLjYtMTEuMiw5LjgtMTMuNWwxMy40LTUuNEw3MjkuNiwxMTcuOEw3MjkuNiwxMTcuOHoiPjwvcGF0aD48L2c+PHBhdGggZD0iTTAsMHY5MC40YzAsNjUuNyw1MC45LDg4LjUsODguMSwxMDUuMmgwLjFsMywxLjRjMC43LTAuNCwxLjQtMC43LDIuMi0xYzAuNC0wLjIsMC45LTAuNCwxLjMtMC42IGMzNy4zLTE2LjYsODguNC0zOS41LDg4LjQtMTA1VjBIMHogTTExNiwxMzJsLTItNS4zbC0yNi42LTcwYy0xLjYsNC4xLTUuMywxNC05LjMsMjQuNmwtMTUuMyw0MS4zYy0wLjcsMi0wLjMsMywwLjIsMy43IGMxLjEsMS4zLDMuNSwxLjMsNy4zLDEuM0g3MWwwLDQuNEg0Mi40bDAtNC40aDIuMmMzLjksMCw3LjEtMS43LDkuNS02LjVsMi45LTYuNmwyNi41LTY3LjhsLTQuNy0xMi41aDI0LjdsMzQuMSw4OS43bDMuMSw4LjFIMTE2eiI+PC9wYXRoPjwvc3ZnPg==" /></a>

#### Computer Science Annex

<a href="/csannex/sprint/recMPt6jmsCgaqrfj" class="bd-toc-link">1.  Data Structures: Heaps</a>

-   [Heaps](/csannex/module/recNbOiLfM7bfQ0aE/)

<a href="/csannex/sprint/recKzV5STy8vYnbQ1" class="bd-toc-link">2.  Intro to Django</a>

-   [Django basics and setup](/csannex/module/recvCvXoZKm5cYOc4/)
-   [Building APIs](/csannex/module/recuEEEsf9eXphxy0/)

<a href="/csannex/sprint/recUHGX7arXkBIutr" class="bd-toc-link">3.  Python/Django I</a>

-   [Getting started with Python and Django](/csannex/module/rec4yg0hRHaeOmBGN/)
-   [Object-Oriented Programming](/csannex/module/recHhVqI4Y3j6UgLa/)
-   [Software Design Patterns](/csannex/module/recgVHqW0RShuQn1Z/)

<a href="/csannex/sprint/rec64nbdwB28JM7Qu" class="bd-toc-link">4.  Python/Django II/Career Development</a>

-   [REST](/csannex/module/rec7YHjLuXabdlhof/)
-   [GraphQL](/csannex/module/recjIPIwz5Pn5WbPh/)
-   [Model-View-Controller](/csannex/module/recVsikSMFoQ25WZd/)

<a href="/csannex/sprint/reczMSFEG5pffpADx" class="bd-toc-link">5.  Python/Django III/Career Development</a>

-   [Object-relational mapping](/csannex/module/reccrn1If8mhlIymc/)
-   [Relational Databases](/csannex/module/recU6Q1DLISGvt0dk/)

<a href="/csannex/sprint/recTTpwFpgZXtPG2o" class="bd-toc-link">6.  Project Week: Cellular Automata</a>

-   [Game of Life](/csannex/module/rec42j1bkTmC0Hsro/)

<a href="/csannex/sprint/recqkHjNcXzK5DTqd" class="bd-toc-link">7.  C Programming Topics</a>

-   [Introduction To C](/csannex/module/recLymrrD7f46rdBa/)
-   [Processes and System Calls](/csannex/module/rec7YmMV7ukDLK770/)
-   [Scheduling](/csannex/module/recfiYtQDLFXGOBFA/)
-   [Operating Systems](/csannex/module/recHPT5QiPS6NOCgz/)
-   [Web Server I](/csannex/module/recz76g3pcHs88Dax/)
-   [Web Server II](/csannex/module/recFGnBVmKCyR0427/)
-   [Theory of Computation](/csannex/module/recH0OAnSr6ZcnZ7F/)

-   [Prepare](#prepare)
-   [Learn](#learn)
-   [Review](#review)

# Web Server II

<span class="lead"> </span>

In this part of the sprint, we’ll add *caching* functionality to the webserver. This will improve performance for frequently-accessed files.

**At the end of this module, you should be able to:**

-   understand MIME types and determine them from file names
-   describe and utilize a doubly-linked list
-   implement an LRU cache

#### Pro Tip

When talking about your journey, don’t focus on things you don’t know yet, focus on what you’ve learned and how quickly.

## <a href="#prepare" id="prepare" class="anchor"><span class="octicon octicon-link"></span></a>Prepare

Review each preclass resource before class.

-   

    # An error occurred.

    [Try watching this video on www.youtube.com](https://www.youtube.com/watch?v=emkbJJau--k), or enable JavaScript if it is disabled in your browser.

-   

    # An error occurred.

    [Try watching this video on www.youtube.com](https://www.youtube.com/watch?v=3e2QbeYxh2c), or enable JavaScript if it is disabled in your browser.

-   

    # An error occurred.

    [Try watching this video on www.youtube.com](https://www.youtube.com/watch?v=GaibISkdobY), or enable JavaScript if it is disabled in your browser.

## <a href="#learn" id="learn" class="anchor"><span class="octicon octicon-link"></span></a>Learn

#### Learn to understand MIME types and determine them from file names

MIME types are widely used in email and the web. Although it’s a simple concept, its common use warrants a short, complete description.

##### Overview

*Multipurpose Internet Mail Extensions* (MIME) was originally created for email, as its name suggests.

It used to be, back in the day when cavemen were painting their hands on cave walls, that all email was ASCII text and that was all. If you wanted to include an image, you had to draw it in ASCII-art.

So in order to pass other kinds of data in email, MIME was invented. It allowed emails to contain multiple parts, and had a way of identifying the type of data that was contained within each part.

MIME is still used for email to this day.

But the designers of the web recognized that many of the same problems could be solved by using MIME with the web, as well.

One of the problems is identifying the type of data that is arriving from the server.

##### Follow Along

##### What type is my data?

Bytes are just numbers. So when the web browser receives a stream of bytes from the server, how can it tell if this is unicode HTML data, binary animated-gif data, or a JPEG vacation photograph? They’re all just streams of numbers!

The server has to tell the browser what type this data is. And it does this by specifying the MIME type.

Here are some common MIME types:

-   JPEG: `image/jpeg`
-   GIF: `image/gif`
-   PNG: `image/png`
-   JavaScript: `application/javascript`
-   JSON: `application/json`
-   CSS: `text/css`
-   HTML: `text/html`
-   Plain TXT: `text/plain`
-   Non-descript data: `application/octet-stream`

> *Octet* is another name for an 8-bit value, commonly known as a *byte*. (Historically the number of bits in a byte varied, even though today they’re vitually always 8 bits. An octet is *always* 8 bits by definition.)

There are [a lot of MIME types](https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Complete_list_of_MIME_types).

##### How to determine the type of data served?

###### Programmatic endpoints

If you have a programmatic endpoint (e.g. an endpoint that generates the data instead of reading it from disk) then you simply specify the type of the data you’re sending back.

For example, if you return data is:

    {
        "animal_type": "goat",
        "count": 37
    }

then you’ll use the content type of `application/json`.

###### File serving

But what if you’re reading data from a file and serving it?

If the client requests `http://example.com/foo.png`, we need to reply with a type of `image/png`. The usual way to do this is to simply map between the file extension `.png` and its MIME type `image/png`.

1.  Isolate the file extension.

    Examples:

    File is `frotz.jpg`, extension is `.jpg`.

    File is `foo.bar.txt`, extension is `.txt`.

2.  Map the extension to its MIME type.

    Example: `.txt` maps to `text/plain`

3.  If you can’t find a mapping for an extension, use `application/octet-stream`.

Comparisons are case-insensitive. Here are some examples:

-   `.jpg` or `.jpeg`: `image/jpeg`
-   `.gif`: `image/gif`
-   `.png`: `image/png`
-   `.js`: `application/javascript`
-   `.json`: `application/json`
-   `.css`: `text/css`
-   `.htm` or `.html`: `text/html`
-   `.txt`: `text/plain`
-   `.ico`: `image/x-icon`

### How is the MIME type returned?

It comes back in the HTTP header in the `Content-Type` field:

    Content-Type: text/html

Whichever library you are using should have a way to set the `Content-Type` header.

Webservers construct their own HTTP headers so the `Content-Type` is included at that time.

##### What does a browser (or other client) do with the MIME type?

The browser uses the MIME type of the data to decide what to do with it. If it’s `text/html`, it displays it. Probably the same with `image/*` data. Also `text/plain`.

The browser can display a number of types of data natively. But what if it gets one it doesn’t know? There are, after all, about 1.2 zillion MIME types.

In that case, it has two options:

1.  It can spawn an external viewer to show the file, if it is aware of one.

2.  It can simply download the file and let the user deal with it later.

##### Challenge

-   Besides email and the web, where else are MIME types used?
-   Research how MIME *multipart* works.
-   What is the MIME type for a MOD audio file?
-   What is the MIME type for a Commodore 64 floppy disk image file?

------------------------------------------------------------------------

#### Learn to describe and utilize a doubly-linked list

You’re already familiar with the linked list. A common variant is the *doubly-linked list* which adds some additional speed and flexibility improvement in exchange for some additional complexity.

##### Overview

A doubly-linked list is very much like a standard linked list, except the links go both to `next` and `prev`ious nodes in the list.

In addition to the pointer to the `head` of the list, we also keep a pointer to the `tail` (last element) of the list.

##### Follow Along

A doubly-linked list has a number of benefits:

-   Traverse the list in either direction.

-   If you already have a pointer to any element in this list, you can remove that element in O(1) time.

    (With a standard linked list, you need to traverse to keep track of the pointer to the previous element, making that an O(n) process.)

Drawbacks:

-   There’s more pointer manipulation when changing the list (to manage the `prev` pointers in addition to the `next` pointers).

#### Use in an LRU cache

When used with an LRU cache, pointers to cache entries in the list are also kept in a hash table.

This means if you want to move a just-used cache entry to the front of the list, you can perform the following steps:

1.  Look up the entry in the hash table: O(1)
2.  Remove the entry from its position in the doubly linked list: O(1)
3.  Insert the entry at the head of the doubly linked list: O(1)

##### Challenge

-   Research and list the common use cases

-   Convert one of your previously-written linked lists into a doubly-linked list.

------------------------------------------------------------------------

#### Learn to implement an LRU cache

Caches help speed access to commonly-used data.

LRU caches are a simple, common type of caching mechanism that allows cache gets and puts to happen in O(1) time.

##### Overview

A cache is a place that stores copies of commonly-used information for quick retrieval and lookup. Hitting the cache for a piece of data should be faster than getting it from the original source.

The idea is that if lots of people want access to this piece of data, you copy it into the faster cache so they all get it in a more timely manner.

There is a cache on your CPU that keeps commonly-used parts of RAM so the CPU doesn’t have to wait for the slower RAM each time.

Your web browser keeps a cache of web pages and other web data so that it doesn’t have to retrieve it over the network every time you go to a page, greatly speeding up page load times.

A web server can also cache files so that it doesn’t have to go through the operating systems to get files off disk every time. It can just retrieve the file from RAM and serve it directly.

##### Follow Along

#### LRU Caches

Of course, you can’t cache *everything* *forever*. You’d need a cache as big as all the stuff you’re wanting to store, if you wanted to do that. And a web server might have access to several terabytes of data, but only have a few gigabytes of RAM.

So you have to be selective. It makes a lot of sense to have a cache of limited size, and fill that cache with the most frequently-accessed data.

One strategy for doing this is called an *LRU cache*. This cache type has a fixed number of entries (or size in bytes).

In the context of a webserver, when a file is requested by a client, the following steps occur:

1.  Check if the file is in the cache.

2.  If it is, serve it. We’re done.

3.  If it’s not in the cache, load it from disk.

4.  Save it in the cache.

5.  Serve it.

If the cache exceeds its max size, the *least recently used* entry in the cache is discarded.

#### How to build an LRU cache

##### Structure

LRU caches are made of two cooperating data structures: a doubly linked list and a hash table.

-   The hash table is used for quick lookup into the doubly linked list.

-   The doubly linked list is used to keep track of which entries are least-recently used.

    The item at the head of the list is the most-recently used.

    The item at the tail is the least-recently used.

##### Putting items in the cache

The item will be identified by a key (in the case of a webserver, the key should be a string containing the path on disk to the file in question).

A *cache entry* will contain copies of all the information needed to serve the file again if it is retrieved from the cache. For a webserver, this is things like content MIME type, content length, and the content itself.

Additionally the cache entry should have `prev` and `next` pointers so it can be used in a doubly linked list.

Finally, it should also contain a copy of the key.

For putting an item in the cache:

1.  Construct a new cache entry containing all the required information.

2.  Add a pointer to the cache entry to the head of the doubly linked list.

3.  Add a pointer to the cache entry to the hash table, indexed by the key.

4.  If the cache is larger than its max allowable size, see [LRU discarding](#lru-discarding), below.

### Getting items from the cache

1.  Look up the cache entry pointer in the hash table with the key.

2.  If it’s not in the hash table, it’s not in the cache. We’re done.

3.  If it is found, the cache entry is cut out of the doubly linked list.

4.  The cache entry is inserted at the head of the list. (Because it’s now the most-recently used.)

Since every time you get an item from the cache it moves to the head of the list, it becomes most-recently used. In this way, frequently-used entries tend to bubble up to the head of the list and less-frequently-used entries tend to fall to the tail of the list.

##### LRU discarding

If the cache is larger than its allowable max size, the least-recently used items must be discarded.

This typically happens when an item is inserted in the list that pushes it oversize.

-   while size > max\_size:
    -   get the cache entry at the tail of the list
    -   remove it from the tail of the list
    -   using its key, remove it from the hash table

##### Challenge

-   What are some applications of LRU caches?
-   How would you add functionality to the cache (in pseudocode) to remove entries that are older than a cutoff age from the cache? O(n) time is OK.
-   How would you remove entries as above in O(1) time?

------------------------------------------------------------------------

## <a href="#review" id="review" class="anchor"><span class="octicon octicon-link"></span></a>Review

### Class Recordings

You can use class recordings to help you master the material.

-   **[Web Server II for CS11 w/Sean](https://youtu.be/wm7fDiONOAk)**

    Web Server II

-   [All previous recordings](/archive/CSAnnex/module/recFGnBVmKCyR0427)

### Demonstrate Mastery

To demonstrate mastery of this module, you need to complete and pass a code review on each of the following:

-   Objective challenge:
    -   Besides email and the web, where else are MIME types used?
    -   Research how MIME *multipart* works.
    -   What is the MIME type for a MOD audio file?
    -   What is the MIME type for a Commodore 64 floppy disk image file?
-   Objective challenge:
    -   Research and list the common use cases

    -   Convert one of your previously-written linked lists into a doubly-linked list.
-   Objective challenge:
    -   What are some applications of LRU caches?
    -   How would you add functionality to the cache (in pseudocode) to remove entries that are older than a cutoff age from the cache? O(n) time is OK.
    -   How would you remove entries as above in O(1) time?
