<a href="#content" id="skippy" class="sr-only sr-only-focusable"></a>

<span class="skiplink-text">Skip to main content</span>

<a href="/" class="navbar-brand"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMyIgaGVpZ2h0PSIzNSIgdmlld2JveD0iMCAwIDMzIDM1IiBmaWxsPSJub25lIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0wIDBWMTYuMDYwOUMwIDI3LjczMzUgOS4wODkyOSAzMS43ODQzIDE1LjczMjEgMzQuNzUxM0gxNS43NUwxNi4yODU3IDM1QzE2LjQxMDcgMzQuOTI4OSAxNi41MzU3IDM0Ljg3NTYgMTYuNjc4NiAzNC44MjIzQzE2Ljc1IDM0Ljc4NjggMTYuODM5MyAzNC43NTEzIDE2LjkxMDcgMzQuNzE1N0MyMy41NzE0IDMxLjc2NjUgMzIuNjk2NCAyNy42OTggMzIuNjk2NCAxNi4wNjA5VjBIMFpNMjAuNzA3MSAyMy40NTM2TDIwLjM1NzEgMjIuNTEwMkwxNS42MDcxIDEwLjA3MzZDMTUuMzIxNCAxMC44MDIgMTQuNjYwNyAxMi41NjA5IDEzLjk0NjQgMTQuNDQ0MkwxMS4yMTQzIDIxLjc4MTdDMTEuMDg5MyAyMi4xMzcxIDExLjE2MDcgMjIuMzE0NyAxMS4yNSAyMi40MzkxQzExLjQ0NjQgMjIuNjcwMSAxMS44NzY4IDIyLjY3MDEgMTIuNTU1NCAyMi42NzAxSDEyLjY3ODZMMTIuNjc2OCAyMy40NTE4SDcuNTY5NjRWMjIuNjcwMUg3Ljk2MjVDOC42NTg5MyAyMi42NzAxIDkuMjMwMzYgMjIuMzY4IDkuNjU4OTMgMjEuNTE1MkwxMC4xNzY4IDIwLjM0MjZMMTQuOTA4OSA4LjI5Njk2TDE0LjA2OTYgNi4wNzYxNEgxOC40ODA0TDI0LjU2OTYgMjIuMDEyN0wyNS4xMjUgMjMuNDUzNkgyMC43MDcxWiIgZmlsbD0iI0VDMzk0NCI+PC9wYXRoPgo8L3N2Zz4=" /></a>

![](data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdib3g9IjAgMCAzMCAzMCIgd2lkdGg9IjMwIiBoZWlnaHQ9IjMwIiBmb2N1c2FibGU9ImZhbHNlIj48dGl0bGU+TWVudTwvdGl0bGU+PHBhdGggc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNNCA3aDIyTTQgMTVoMjJNNCAyM2gyMiI+PC9wYXRoPjwvc3ZnPg==)

#### Web Applications II

<a href="/web3/sprint/recq59MvEIZfUAohy" class="bd-toc-link">1.  Advanced React</a>

- [Class Components](/web3/module/recnDKrWb24lgaziC/)
- [The React Lifecycle](/web3/module/rec1DPoOZSmocXfak/)
- [Composing and Sharing Non-Visual Behavior](/web3/module/recAxmnYmusEi8JuL/)
- [Testing Web Applications](/web3/module/rechTQVfCg4p85Hoi/)

<a href="/web3/sprint/recukritK1B1pFrcM" class="bd-toc-link">2.  Advanced State Management</a>

- [The Reducer Pattern](/web3/module/rectpk6uIV3pCHJh8/)
- [Redux](/web3/module/recba2NUdVmgKYyR3/)
- [Async Redux](/web3/module/recSoiWNJzGURrXYh/)
- [Context API](/web3/module/recByjgF7FwwH5Z7W/)

<a href="/web3/sprint/recnhsJGy28gNi1K5" class="bd-toc-link">3.  Advanced Web Applications</a>

- [Testing React](/web3/module/recS9H6qCj0dQe32B/)
- [Client-Side Authentication](/web3/module/recQlbCZf9tOVgiXC/)
- [HTTP / AJAX II](/web3/module/recupVjaAKPqbuk7Y/)
- [Deploying Web Apps](/web3/module/receOMvCB7dSyX5FL/)

<a href="/web3/sprint/recVFiuMBzbcZllxC" class="bd-toc-link">4.  WEB Unit 3 Build</a>

<a href="/" class="navbar-brand"><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTM1IiBoZWlnaHQ9IjM1IiB2aWV3Ym94PSIwIDAgNzU2IDE5NyIgZmlsbD0iI2VjMzk0NCI+PGc+PHBhdGggZD0iTTI5Mi45LDEyNi42aC02LjdjLTksMC0xMi42LTEuOS0xMi42LTkuNVY0OC41YzAtNy43LDEuNi04LjYsMTEuNC05Ljd2LTQuNWgtNDEuM3Y0LjUgYzkuOCwxLjEsMTEuNCwxLjksMTEuNCw5Ljd2NjkuM2MwLDcuNy0xLjYsOC42LTExLjQsOS43djQuNWg3My43bDQuOS0yOS40aC00LjRDMzA4LjUsMTE5LjYsMzAzLjksMTI2LjYsMjkyLjksMTI2LjZ6Ij48L3BhdGg+PHBhdGggZD0iTTM4NS41LDEyMS4xVjc5LjNjMC0xNS44LTkuNC0yMi40LTI2LjYtMjIuNGMtMTUsMC0yNi44LDYuNi0yNi44LDE5LjNjMCwyLjQsMC4yLDMuMywwLjgsNWgxNi42IGMtMC41LTItMC43LTUtMC43LTcuNWMwLTkuNiwzLjYtMTIuNCw5LjQtMTIuNGM2LjQsMCw5LjcsMiw5LjcsMTQuNHYxMS4ybC0yMC44LDcuN2MtMTAuNiw0LjEtMTkuMyw4LjgtMTkuMywyMC43IGMwLDEwLjksNy41LDE3LjgsMTguNiwxNy44YzkuOSwwLDE3LjQtNi4yLDIxLjktMTIuMWwwLjEtMC4xbDAsMFYxMzJoMjZ2LTQuNEMzODcuNywxMjcuMSwzODUuNSwxMjYuMiwzODUuNSwxMjEuMXogTTM2OCwxMTcuOCBjLTQuNCwzLjMtNy42LDUuMy0xMiw1LjRjLTcuNywwLTExLjItNS4yLTExLjItMTIuNmMwLTcuNywzLjYtMTEuMiw5LjgtMTMuNWwxMy40LTUuNFYxMTcuOEwzNjgsMTE3Ljh6Ij48L3BhdGg+PHBhdGggZD0iTTUxNC40LDEyMVY3OS41YzAtMTQuOC02LTIyLjQtMTguNy0yMi40Yy0xMS41LDAtMTkuNCw2LjYtMjUuNSwxMy45Yy0xLjgtOS42LTcuNy0xMy45LTE3LjgtMTMuOSBjLTExLjQsMC0xOC43LDYuMi0yNC44LDEzLjZWNTdoLTIuM2wtMjMuOCw3LjR2Mi40bDguNiw1djQ5LjRjMCw1LTIuMSw2LjEtOC45LDYuNHY0LjRoMzUuMXYtNC40Yy02LjctMC4zLTguNy0xLjMtOC43LTYuNHYtNDcgYzQuNy0zLjYsOS41LTYuNSwxNS41LTYuNWM3LjYsMCwxMC41LDQuMiwxMC41LDEyLjd2NDAuOGMwLDUtMS45LDYuMS04LjcsNi40djQuNGwzNC44LDB2LTQuNGMtNi43LTAuMy04LjYtMS4zLTguNi02LjR2LTQ3IGM0LjctMy42LDkuNS02LjUsMTUuNS02LjVjNy42LDAsMTAuNSw0LjIsMTAuNSwxMi43bC0wLjEsNDAuNWMwLDUtMS44LDYuNC04LjYsNi43bDAsNC40aDM1LjF2LTQuNCBDNTE2LjcsMTI3LjQsNTE0LjQsMTI2LjEsNTE0LjQsMTIxeiI+PC9wYXRoPjxwYXRoIGQ9Ik01NzMuMiw1Ny4zYy0xMSwwLTE4LjUsNS43LTIzLjQsMTIuOFYyMi45aC0yLjdsLTIzLjQsNi44djIuNWw4LjYsNC41VjEzMmgyLjlsOC0zLjVjNS44LDMuMywxMi4zLDUsMjAuMiw1IGMyMC44LDAsMzcuNC0xNS44LDM3LjQtNDIuNkM2MDAuOSw2OS45LDU5MC40LDU3LjMsNTczLjIsNTcuM3ogTTU2My40LDEyOC43Yy01LjQsMC0xMC4zLTIuNC0xMy43LTcuOVY3My42IGMzLjQtMy40LDguNS01LjcsMTMuNS01LjdjMTMuOSwwLDIwLDEyLjgsMjAsMjkuNUM1ODMuMywxMTQuNyw1NzUuOCwxMjguNSw1NjMuNCwxMjguN3oiPjwvcGF0aD48cGF0aCBkPSJNNjc3LDEyMS4yVjIyLjhoLTIuNkw2NTEsMjkuNlYzMmw4LjYsNC41djI1LjdjLTMuNC0zLjItOC44LTUuMS0xNS41LTUuMWMtMTkuOSwwLTM1LjIsMTUuMy0zNS4yLDQxLjMgYzAsMjAuNywxMS4yLDM0LjYsMjguMSwzNC42YzkuOCwwLDE3LTUuMywyMi42LTEzLjF2MC45VjEzMmgyNi4zbDAtNC40QzY3OS4xLDEyNy4zLDY3NywxMjYuMyw2NzcsMTIxLjJ6IE02NTkuNiwxMTcuMSBMNjU5LjYsMTE3LjFjLTMuNCwzLjQtOCw1LjEtMTMuMiw1LjFjLTEzLjIsMC0yMC40LTEyLjgtMjAuNC0yOS44YzAtMTcuOCw3LjMtMjkuMiwxOS41LTI5LjJjOC43LDAsMTQuMSw2LjksMTQuMSwxOC4zIEw2NTkuNiwxMTcuMXoiPjwvcGF0aD48cGF0aCBkPSJNNzQ3LjEsMTIxLjFWNzkuM2MwLTE1LjgtOS40LTIyLjQtMjYuNi0yMi40Yy0xNSwwLTI2LjgsNi42LTI2LjgsMTkuM2MwLDIuNCwwLjIsMy4zLDAuOCw1aDE2LjYgYy0wLjUtMi0wLjctNS0wLjctNy41YzAtOS42LDMuNi0xMi40LDkuNC0xMi40YzYuNCwwLDkuNywyLDkuNywxNC40djExLjJsLTIwLjgsNy43Yy0xMC42LDQuMS0xOS4zLDguOC0xOS4zLDIwLjcgYzAsMTAuOSw3LjUsMTcuOCwxOC42LDE3LjhjOS45LDAsMTcuNC02LjIsMjEuOS0xMi4xdi0wLjFoMC4xbDAsMTEuMWwyNiwwLjF2LTQuNUM3NDkuMywxMjcuMSw3NDcuMSwxMjYuMiw3NDcuMSwxMjEuMXogTTcyOS42LDExNy44Yy00LjQsMy4zLTcuNiw1LjMtMTIuMSw1LjRjLTcuNywwLTExLjItNS4yLTExLjItMTIuNmMwLTcuNywzLjYtMTEuMiw5LjgtMTMuNWwxMy40LTUuNEw3MjkuNiwxMTcuOEw3MjkuNiwxMTcuOHoiPjwvcGF0aD48L2c+PHBhdGggZD0iTTAsMHY5MC40YzAsNjUuNyw1MC45LDg4LjUsODguMSwxMDUuMmgwLjFsMywxLjRjMC43LTAuNCwxLjQtMC43LDIuMi0xYzAuNC0wLjIsMC45LTAuNCwxLjMtMC42IGMzNy4zLTE2LjYsODguNC0zOS41LDg4LjQtMTA1VjBIMHogTTExNiwxMzJsLTItNS4zbC0yNi42LTcwYy0xLjYsNC4xLTUuMywxNC05LjMsMjQuNmwtMTUuMyw0MS4zYy0wLjcsMi0wLjMsMywwLjIsMy43IGMxLjEsMS4zLDMuNSwxLjMsNy4zLDEuM0g3MWwwLDQuNEg0Mi40bDAtNC40aDIuMmMzLjksMCw3LjEtMS43LDkuNS02LjVsMi45LTYuNmwyNi41LTY3LjhsLTQuNy0xMi41aDI0LjdsMzQuMSw4OS43bDMuMSw4LjFIMTE2eiI+PC9wYXRoPjwvc3ZnPg==" /></a>

#### Web Applications II

<a href="/web3/sprint/recq59MvEIZfUAohy" class="bd-toc-link">1.  Advanced React</a>

- [Class Components](/web3/module/recnDKrWb24lgaziC/)
- [The React Lifecycle](/web3/module/rec1DPoOZSmocXfak/)
- [Composing and Sharing Non-Visual Behavior](/web3/module/recAxmnYmusEi8JuL/)
- [Testing Web Applications](/web3/module/rechTQVfCg4p85Hoi/)

<a href="/web3/sprint/recukritK1B1pFrcM" class="bd-toc-link">2.  Advanced State Management</a>

- [The Reducer Pattern](/web3/module/rectpk6uIV3pCHJh8/)
- [Redux](/web3/module/recba2NUdVmgKYyR3/)
- [Async Redux](/web3/module/recSoiWNJzGURrXYh/)
- [Context API](/web3/module/recByjgF7FwwH5Z7W/)

<a href="/web3/sprint/recnhsJGy28gNi1K5" class="bd-toc-link">3.  Advanced Web Applications</a>

- [Testing React](/web3/module/recS9H6qCj0dQe32B/)
- [Client-Side Authentication](/web3/module/recQlbCZf9tOVgiXC/)
- [HTTP / AJAX II](/web3/module/recupVjaAKPqbuk7Y/)
- [Deploying Web Apps](/web3/module/receOMvCB7dSyX5FL/)

<a href="/web3/sprint/recVFiuMBzbcZllxC" class="bd-toc-link">4.  WEB Unit 3 Build</a>

- [Prepare](#prepare)
- [Learn](#learn)
- [Project](#project)
- [Review](#review)

# Async Redux

<span class="lead"> </span>

By nature Redux is synchronous. Because of this we need to apply some middleware to extend the functionality of our Redux package to allow for things like, promises (which are asynchronous). This module will teach you how to set up Redux-Thunk as a middleware for Redux. You will also learn how to use the Redux-Thunk package to extend your actions so that you have the ability to consume promises.

**At the end of this module, you should be able to:**

- describe the Finite State Machine pattern and it's relationship to building Redux applications
- implement Redux Middleware libraries into a Redux Store using \`applyMiddleware\`
- effectively use \`redux-thunk\` and asynchronous action creators to consume data from external API's

#### Pro Tip

When raising a problem with a supervisor, provide potential solutions to the problem.

## <a href="#prepare" id="prepare" class="anchor"><span class="octicon octicon-link"></span></a>Prepare

Review each preclass resource before class.

- # An error occurred.

  [Try watching this video on www.youtube.com](https://www.youtube.com/watch?v=g57ZVWD4HFo), or enable JavaScript if it is disabled in your browser.

- # An error occurred.

  [Try watching this video on www.youtube.com](https://www.youtube.com/watch?v=yTOVUuFX5TU), or enable JavaScript if it is disabled in your browser.

- # An error occurred.

  [Try watching this video on www.youtube.com](https://www.youtube.com/watch?v=hb_ghK58_A8), or enable JavaScript if it is disabled in your browser.

- [Introduction to Finite State Machines](https://www.smashingmagazine.com/2018/01/rise-state-machines/)

- [From Redux to State Machine](http://krasimirtsonev.com/blog/article/getting-from-redux-to-state-machine-with-stent)

## <a href="#learn" id="learn" class="anchor"><span class="octicon octicon-link"></span></a>Learn

#### Learn to describe the Finite State Machine pattern and it's relationship to building Redux applications

Have you ever wondered why most buggy behaviors in software can be _corrected_ by restarting the software?

Bugs are often caused by the software getting into an inconsistent **state** and **restarting it resets the state**.

That implies that most software at it’s core happens to be a _Finite State Machine_. Throughout this objective we’re going to learn all about what Finite State Machines are, how they work and how we as developers can utilize them to create more consistent/fluid software.

##### Overview

A _state machine_ is a mathematical model of computation.

A machine can have a finite number of states, but it can only operate in one state at a given time.

There are different types of state machines, but for building UIs (and understanding Redux), we’ll concentrate on the type that has an initial state. The next state is calculated based on input and the current state.

For our purposes, a State Machine has:

- initial state (store).
- current state (store).
- inputs or actions (action creators) that trigger transitions (reducers) to the next state.

It helps to think in terms of _states_ instead of _transitions_.

Redux is **NOT** a finite state machine, but the thinking in states helps our understanding of how Redux works.

A simple example would be an application that has two main parts: 1) a control dashboard, and 2) a display. The application can be expressed in states and actions like so:

<table><thead><tr class="header"><th style="text-align: left;">current state</th><th style="text-align: center;">action (input)</th><th style="text-align: left;">new state</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">locked closed</td><td style="text-align: center;">unlock</td><td style="text-align: left;">unlocked closed</td></tr><tr class="even"><td style="text-align: left;">unlocked closed</td><td style="text-align: center;">lock</td><td style="text-align: left;">locked closed</td></tr><tr class="odd"><td style="text-align: left;">unlocked closed</td><td style="text-align: center;">open</td><td style="text-align: left;">unlocked open</td></tr><tr class="even"><td style="text-align: left;">unlocked open</td><td style="text-align: center;">close</td><td style="text-align: left;">locked closed</td></tr><tr class="odd"><td style="text-align: left;">unlocked open</td><td style="text-align: center;">lock</td><td style="text-align: left;">locked open</td></tr><tr class="even"><td style="text-align: left;">locked open</td><td style="text-align: center;">unlock</td><td style="text-align: left;">unlocked open</td></tr></tbody></table>

##### Follow Along

What we are going to do now is exercise our brainpower and [read an article about State Machines](http://krasimirtsonev.com/blog/article/managing-state-in-javascript-with-state-machines-stent) and how they may have some pertinence to UI and React state in particular.

##### Challenge

Consider the following Diagram:

graph LR A(isLoggedOut) -- HTTP Request Login --> B(pendingLoginState) B -- Success/Failure --> C(isLoggedIn) C -- HTTP Request Logout --> B B -- Success/Failure --> A

On your own: Write a paragraph that tells us what you know about the finite state machine pattern. It doesn’t have to be long, just a few sentences on the subject. Submit that paragraph to your PM.

---

#### Learn to implement Redux Middleware libraries into a Redux Store using \`applyMiddleware\`

Middleware is a powerful extension point for Redux. We can use middleware to add new functionality to Redux.

There are plenty of third party middleware available for use. We will learn how to use them in our React/Redux applications.

##### Overview

Middleware is a common tool used in programming. You will see middleware used a lot when you start learning about NodeJS.

Middleware intercepts some process, runs a function at the intercept point, then (usually) continues the process. Or, sometimes middleware stops the process entirely.

When whatever “process” in question is kicked off, there is usually data that is flowing through different functions. With middleware, when we “intercept” the process, we are usually trying to use that flowing data.

Middleware in Redux is very common and gives us a chance to do a few different things with the data passing from action creators to the reducers. This is what it looks like with Redux:

Middleware intercepts every action **before** it flows through to the Reducers.

Middleware can:

- stop actions.
- forward an action untouched.
- dispatch a different action.
- dispatch multiple actions.

We can have multiple middleware.

Middleware runs sequentially, in the order, they are defined.

Middleware is added to the store when it is created.

A traditional Redux application flows like this:

graph LR A\[Component\] -- calls --> B\[Action Creator\] B -- returns an --> C\[Action\] C -- is dispatched to all --> D\[Reducers\] D -- updates --> E\[State\] E -- sends changes to --> A

When we add middleware the flow changes to this:

graph LR A\[Component\] -- calls --> B\[Action Creator\] B -- returns an --> C\[Action\] C -- flows through all --> D(Middleware) D -- \_AND THEN\_ dispatched to all --> E(Reducers) E -- updates --> F\[State\] F -- sends changes to --> A

##### Follow Along

Let’s add a logger middleware library to any React/Redux app you have in codesandbox. It can be _any_ sandbox you have with Redux implemented as long as the app is working.

Next, we want to add `redux-logger` as a dependency. In codesandbox, you add it from the dependency button. In a normal app, you would run `npm install redux-logger`.

Next, we want to import it into our application.

    import logger from 'redux-logger';

Finally, we need to import a helper function from redux. This function is the `applyMiddleware` function. You can probably guess that we will pass `logger` into this function. You would be correct! But the `applyMiddleware` function is going to be inside the `createStore` function. It looks like this:

    import { applyMiddleware, createStore } from 'redux';
    import logger from 'redux-logger';

    const store = createStore(
      reducer,
      applyMiddleware(logger)
    );

… That’s it! This is a very basic middleware package that will console.log your actions as they flow through the action creators, before they hit the reducer.

Go ahead and try it out. Open your console (it will look better if it is in its own window, and not in the codesandbox page), open the console, and then interact with your app. You will see the actions as they are logged, the state tree before the action passes to the reducer, and the resulting state tree after the action passes to the reducer!

_Note: if you use redux-logger with other middleware packages, make sure logger is passed to applyMiddleware last._

##### Challenge

Look at this package - https://github.com/elgerlambert/redux-localstorage. Try to now implement this so that your store is saved to `localStorage`. The configuration is a little different than what we did above, so you will have to follow what the docs show.

---

#### Learn to effectively use \`redux-thunk\` and asynchronous action creators to consume data from external API's

In Redux the _Reducers_ are **synchronous** by default. If we need to perform asynchronous operations, they need to happen before the actions flow through the reducers stack.

We can use middleware to handle asynchronous requests.

Redux Thunk is a middleware created by Dan Abramov, that provides the ability to handle asynchronous operations inside our Action Creators.

##### Overview

Redux Thunk is a separate node package called `redux-thunk`. Since the Redux action -> reducer flow is synchronous, we will use Redux Thunk to make the flow asynchronous and make API calls from our action creators.

Yep. You read that correctly. We are changing up the action creators to perform asynchronous API calls. We can do this because we know that Redux middleware intercepts the normal Redux flow, and can make a call before actions make it to the reducer. To make this work, we need to understand `thunks`.

`thunk` is another word for a function. But it’s not just any old function. It’s a special (and uncommon) name for a function that’s returned by another function. Like this:

    function not_a_thunk() {
      // this one is a "thunk" because it defers work for later:
      return function() {
        console.log('do stuff now');
      };
    }

So how does this apply to Redux? Well, when we start using the `redux-thunk` middleware, it does an interesting thing with our redux flow. When an action creator is called `redux-thunk` intercepts and acts on returned data. If the thing returned is an action, it forwards the action through to the reducer. But, if the thing returned is a function, aka a thunk (a function returned from a function), then it invokes the thunk and passes the `dispatch` function as an argument to it.

This is where `redux-thunk` becomes very powerful. The action-creator returned thunk has access to the dispatch function. So we can run an async function, like an API call, and inside the `.then()` we can dispatch an action!

Let’s look at a simple example of an action creator that does this when a user logs in:

    function logInUser(creds) {
      // this returned function is the thunk, and gets dispatch passed in
      return function(dispatch) {
        return axios.post('/login', creds).then(res => {
          const loggedInAction = { type: USER_LOGGED_IN, payload: res.data.user }
          dispatch(loggedInAction);
        });
      };
    }

Really cool, right? The thunk has access to dispatch, and can dispatch a new action based on the result of the API call! Let’s clean this up a little with arrow function syntax. The following code snippet is essentially the exact same as the above snippet:

    const logInUser = creds => dispatch => {
      return axios.post('/login', creds).then(res => {
        const loggedInAction = { type: USER_LOGGED_IN, payload: res.data.user }
        dispatch(loggedInAction);
      });
    }

Much better! Let’s go try it out!

##### Follow Along

We have an app [here](https://codesandbox.io/s/xo8mkrk49w) that is ready to make an API call to the Pokemon API. The first step to accomplishing this is to add `redux-thunk` as a dependency, then go to the main `index.js` page and import it like this:

    import thunk from 'redux-thunk';

Next, we need to tell the `applyMiddleware` function about this piece of middleware.

    const store = createStore(
      rootReducer,
      applyMiddleware(thunk)
    );

Now we’re ready to make our action creators asynchronous!

Go into the `action/index.js` file. You should see an action creator that is returning an action. That action adds an error to state. If you push the “Fetch Pokémon” button, you will see the error rendered on the screen right after it is added to state.

Now, go ahead and remove the entire return statement out of the action creator. Then let’s build the thunk function.

    export const getPokemon = () => dispatch => {

    };

Now, inside the action creator, we have access to dispatch. So, what is this action creator going to do? It is going to fetch pokemon data from the API. So, before we fetch data, let’s remember the finite state machine and dispatch an action that can tell the reducer that we are starting the fetch. (And let’s change the action type to ‘FETCH_POKEMON_START’).

    export const FETCH_POKEMON_START = 'FETCH_POKEMON_START';

    export const getPokemon = () => dispatch => {
      dispatch({ type: FETCH_POKEMON_START });
    };

Now we’ll go to the reducer and build a case for that action. Import the correct action type, and add an `isFetching` property to the `initialState` object. In this case, we will set `isFetching` to true, and reset the `error` back to an empty string, just in case it has an error in it.

    import { FETCH_POKEMON_START } from '../actions';

    const initialState = {
      pokemon: [],
      error: '',
      isFetching: false
    };

    function reducer(state = initialState, action) {
      console.log('reducer', action);
      switch (action.type) {
        case FETCH_POKEMON_START:
          return {
            ...state,
            isFetching: true,
            error: ''
          };

        default:
          return state;
      }
    }

    export default reducer;

Now, back to the action creator to make our API call. To continue, we need to add `axios` as a dependency and import it into the action creator file. Then, make a `GET` request to ‘https://pokeapi.co/api/v2/pokemon/’.

In the `.then()` and `.catch()`, we need to dispatch more actions. Inside the `.then()`, we will dispatch the `FETCH_POKEMON_SUCCESS` action, and pass with it the data we get back from the API. If there is an error, we need to dispatch the `FETCH_POKEMON_FAIL` action and pass with it the error. Make two new action types for both cases, then build out the `.then()` and `.catch()`.

    import axios from 'axios';

    export const FETCH_POKEMON_START = 'FETCH_POKEMON_START';
    export const FETCH_POKEMON_SUCCESS = 'FETCH_POKEMON_SUCCESS';
    export const FETCH_POKEMON_FAIL = 'FETCH_POKEMON_FAIL';

    export const getPokemon = () => dispatch => {
      dispatch({ type: FETCH_POKEMON_START });
      axios
        .get('https://pokeapi.co/api/v2/pokemon/')
        .then(res =>
          dispatch({ type: FETCH_POKEMON_SUCCESS, payload: res.data.results })
        )
        .catch(err => dispatch({ type: FETCH_POKEMON_FAIL, payload: err }));
    };

Finally, we will build the cases for our two new actions. In the reducer file, import our new action types. Then build a case for each inside the reducer function. Before looking at the code below, try to think through what change each action represents on the state tree. Think about finite state machines. Now go ahead and try to build both cases, then compare how you did with the code below.

    import {
      FETCH_POKEMON_START,
      FETCH_POKEMON_SUCCESS,
      FETCH_POKEMON_FAIL
    } from '../actions';

    const initialState = {
      pokemon: [],
      error: '',
      isFetching: false
    };

    function reducer(state = initialState, action) {
      console.log('reducer', action);
      switch (action.type) {
        case FETCH_POKEMON_START:
          return {
            ...state,
            isFetching: true,
            error: ''
          };
        case FETCH_POKEMON_SUCCESS:
          return {
            ...state,
            pokemon: action.payload,
            isFetching: false,
            error: ''
          };
        case FETCH_POKEMON_FAIL:
          return {
            ...state,
            error: action.payload
          };
        default:
          return state;
      }
    }

    export default reducer;

Now push the button again, and there are your pokémon! Here is the final [codesandbox](https://codesandbox.io/s/vy6148rx97) for reference.

##### Challenge

Build out a simple React/Redux app that displays dog images from the dogs API.

##### Dig Deeper

- [Async Redux Dogs](https://codesandbox.io/s/1vzyproz5j)  
  Link to code sandbox for Doggos during AsyncRedux discussion

---

## <a href="#project" id="project" class="anchor"><span class="octicon octicon-link"></span></a>Project

- ##### [React-Redux App](https://github.com/LambdaSchool/React-Redux-App)

  Build a React-Redux app that consumes data from an API of your choosing.

## <a href="#review" id="review" class="anchor"><span class="octicon octicon-link"></span></a>Review

### Class Recordings

You can use class recordings to help you master the material.

- **[Async Redux for Web35 w/ Dustin Myers](https://youtu.be/EBxWcr2JCOU)**

  Async Redux

- [All previous recordings](/archive/FSW/module/recSoiWNJzGURrXYh)

### Demonstrate Mastery

To demonstrate mastery of this module, you need to complete and pass a code review on each of the following:

- Objective challenge:

  Consider the following Diagram:

  graph LR A(isLoggedOut) -- HTTP Request Login --> B(pendingLoginState) B -- Success/Failure --> C(isLoggedIn) C -- HTTP Request Logout --> B B -- Success/Failure --> A

  On your own: Write a paragraph that tells us what you know about the finite state machine pattern. It doesn’t have to be long, just a few sentences on the subject. Submit that paragraph to your PM.

- Objective challenge:

  Look at this package - https://github.com/elgerlambert/redux-localstorage. Try to now implement this so that your store is saved to `localStorage`. The configuration is a little different than what we did above, so you will have to follow what the docs show.

- Objective challenge:

  Build out a simple React/Redux app that displays dog images from the dogs API.

- Project: React-Redux App

- Code Challenge: GetAllProductExceptAtIndex

- Code Challenge: BinaryArraySortInLinearTime
