<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Intended as a home for Lambda School curriculum.">
<meta name="author" content="">
<meta name="generator" content="Jekyll v3.8.0">
<title>Using JSON Web Tokens (JWT) · Lambda School</title>

<link rel='stylesheet' integrity crossorigin='anonymous' href='https://d33wubrfki0l68.cloudfront.net/css/0f99ed215b3d52fa1bee44dc614ea3fa1d1bebc0/dist/css/bootstrap.min.css' />

<link href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" rel="stylesheet">
<link rel='stylesheet' href='https://d33wubrfki0l68.cloudfront.net/css/1bf8317b3d6d0c9d813c92505f052bf79ffdcdfe/assets/css/docs.min.css' />

<link rel='stylesheet' href='https://d33wubrfki0l68.cloudfront.net/css/f3626ab7ab84821f8b60ea92b4a5c6acf59991af/assets/css/main.css' />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-122016605-1', 'learn.lambdaschool.com');
  ga('send', 'pageview');
</script>

<script>
  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t,e){var n=document.createElement("script");n.type="text/javascript";n.async=!0;n.src="https://cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(n,a);analytics._loadOptions=e};analytics.SNIPPET_VERSION="4.1.0";
  analytics.load("BjKorwKrSvMamfNoGkBq9rISk7wF6QQX");
  analytics.page();
  }}();
</script>

<link rel="apple-touch-icon" href="/assets/img/favicons/apple-touch-icon.png" sizes="180x180">
<link rel="icon" href="/assets/img/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
<link rel="icon" href="/assets/img/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
<link rel="manifest" href="/assets/img/favicons/manifest.json">
<link rel="mask-icon" href="/assets/img/favicons/safari-pinned-tab.svg" color="#a0001e">
<link rel="icon" href="/favicon.ico">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#a0001e">
</head>
<body>
<noscript>Please enable JavaScript to view this page.</noscript>
<div id="redirect-message" style="display: none;">
You must be logged in to view this page.
</div>
<div id="unauthorized-message" style="display: none;">
You must be a Lambda School student to view this page.
</div>
<div id="content-wrapper" >
<a id="skippy" class="sr-only sr-only-focusable" href="#content">
<div class="container">
<span class="skiplink-text">Skip to main content</span>
</div>
</a>
<div class="mobile-menu">
<div class="m-drop">
<div class="mobile-row">
<div class="header-row" style="padding: 3px 7px">
<a class="navbar-brand" href="/" aria-label="Lambda School"><svg xmlns="http://www.w3.org/2000/svg" width="33" height="35" viewBox="0 0 33 35" fill="none">
<path fill-rule="evenodd" clip-rule="evenodd" d="M0 0V16.0609C0 27.7335 9.08929 31.7843 15.7321 34.7513H15.75L16.2857 35C16.4107 34.9289 16.5357 34.8756 16.6786 34.8223C16.75 34.7868 16.8393 34.7513 16.9107 34.7157C23.5714 31.7665 32.6964 27.698 32.6964 16.0609V0H0ZM20.7071 23.4536L20.3571 22.5102L15.6071 10.0736C15.3214 10.802 14.6607 12.5609 13.9464 14.4442L11.2143 21.7817C11.0893 22.1371 11.1607 22.3147 11.25 22.4391C11.4464 22.6701 11.8768 22.6701 12.5554 22.6701H12.6786L12.6768 23.4518H7.56964V22.6701H7.9625C8.65893 22.6701 9.23036 22.368 9.65893 21.5152L10.1768 20.3426L14.9089 8.29696L14.0696 6.07614H18.4804L24.5696 22.0127L25.125 23.4536H20.7071Z" fill="#EC3944" />
</svg></a>
<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#mobile-course-menu" aria-controls="mobile-course-menu" aria-expanded="false" aria-label="Toggle navigation">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" width="30" height="30" focusable="false"><title>Menu</title><path stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-miterlimit="10" d="M4 7h22M4 15h22M4 23h22"></path></svg>
</button>
</div>
</div>
<div class="nav-row">
<div class="results-container">
<ul id="results-container" class="dropdown list-group"></ul>
</div>
<div id="mobile-course-menu" class="collapse nav-row">
<div class="docs-mobile-sidebar" id="bd-docs-nav-mobile">
<nav class="bd-links">
<div class="bd-toc-item">
<h4 class="bd-toc-link">Web API: Node</h4>
</div>

<div class="bd-toc-item ">
<a class="bd-toc-link" href="/web4node/sprint/reckzQd7ZgiFY5ok5">
1.&nbsp;&nbsp;Build a Web API
</a>
<ul class="nav bd-sidenav">

<li>
<a href="/web4node/module/recZiPP8Oyg1WlHxT/">
Introduction to Node.js and Express
</a>
</li>
<li>
<a href="/web4node/module/recBjiSulq0PYLCIj/">
Server-Side Routing with Express
</a>
</li>
<li>
<a href="/web4node/module/recCJjYFEz0i5O5p5/">
Express Middleware
</a>
</li>
<li>
<a href="/web4node/module/recs9QOkOAtZhsjc4/">
Web Deployment and Best Practices
</a>
</li>
</ul>
</div>
<div class="bd-toc-item ">
<a class="bd-toc-link" href="/web4node/sprint/receFLR7MpwQXesIN">
2.&nbsp;&nbsp;Adding Data Persistence
</a>
<ul class="nav bd-sidenav">

<li>
<a href="/web4node/module/recFG7SqlSCAB8iU7/">
Introduction to Relational Databases
</a>
</li>
<li>
<a href="/web4node/module/recIbfNn9xRhLTOv4/">
Database Schema Design
</a>
</li>
<li>
<a href="/web4node/module/recw2ezN22yjehidj/">
Multi-Table Queries
</a>
</li>
<li>
<a href="/web4node/module/rec5J23yAIdjmFbgP/">
Data Modeling
</a>
</li>

</ul>
</div>
<div class="bd-toc-item ">
<a class="bd-toc-link" href="/web4node/sprint/recGqGeZ7n75vZivn">
3.&nbsp;&nbsp;Authentication and Testing
</a>
<ul class="nav bd-sidenav">

<li>
<a href="/web4node/module/recQD9lnhqWEFh6g4/">
Introduction to Authentication
</a>
</li>
<li class="active bd-sidenav-active">
<a href="/web4node/module/reciCHdNjavSKaaLt/">
Using JSON Web Tokens (JWT)
</a>
</li>
<li>
<a href="/web4node/module/recd26oZ3GBNHh3Na/">
WEB Unit Testing
</a>
</li>
<li>
<a href="/web4node/module/reciXdxRA8zXJXDID/">
Testing the Back End
</a>
</li>
</ul>
</div>
<div class="bd-toc-item ">
<a class="bd-toc-link" href="/web4node/sprint/recWkcWui91eG1s8q">
4.&nbsp;&nbsp;WEB Unit 4 Node Build
</a>
<ul class="nav bd-sidenav">

</ul>
</div>
</nav>
</div>
</div>
</div>
</div>
</div>
<div class="main-container">
<div class="sidebar-container bd-sidebar">
<div class="docs-sidebar">
<a class="navbar-brand" href="/" aria-label="Lambda School"><svg width="135" height="35" viewBox="0 0 756 197" fill="#ec3944"><g><path d="M292.9,126.6h-6.7c-9,0-12.6-1.9-12.6-9.5V48.5c0-7.7,1.6-8.6,11.4-9.7v-4.5h-41.3v4.5 c9.8,1.1,11.4,1.9,11.4,9.7v69.3c0,7.7-1.6,8.6-11.4,9.7v4.5h73.7l4.9-29.4h-4.4C308.5,119.6,303.9,126.6,292.9,126.6z"></path><path d="M385.5,121.1V79.3c0-15.8-9.4-22.4-26.6-22.4c-15,0-26.8,6.6-26.8,19.3c0,2.4,0.2,3.3,0.8,5h16.6 c-0.5-2-0.7-5-0.7-7.5c0-9.6,3.6-12.4,9.4-12.4c6.4,0,9.7,2,9.7,14.4v11.2l-20.8,7.7c-10.6,4.1-19.3,8.8-19.3,20.7 c0,10.9,7.5,17.8,18.6,17.8c9.9,0,17.4-6.2,21.9-12.1l0.1-0.1l0,0V132h26v-4.4C387.7,127.1,385.5,126.2,385.5,121.1z M368,117.8 c-4.4,3.3-7.6,5.3-12,5.4c-7.7,0-11.2-5.2-11.2-12.6c0-7.7,3.6-11.2,9.8-13.5l13.4-5.4V117.8L368,117.8z"></path><path d="M514.4,121V79.5c0-14.8-6-22.4-18.7-22.4c-11.5,0-19.4,6.6-25.5,13.9c-1.8-9.6-7.7-13.9-17.8-13.9 c-11.4,0-18.7,6.2-24.8,13.6V57h-2.3l-23.8,7.4v2.4l8.6,5v49.4c0,5-2.1,6.1-8.9,6.4v4.4h35.1v-4.4c-6.7-0.3-8.7-1.3-8.7-6.4v-47 c4.7-3.6,9.5-6.5,15.5-6.5c7.6,0,10.5,4.2,10.5,12.7v40.8c0,5-1.9,6.1-8.7,6.4v4.4l34.8,0v-4.4c-6.7-0.3-8.6-1.3-8.6-6.4v-47 c4.7-3.6,9.5-6.5,15.5-6.5c7.6,0,10.5,4.2,10.5,12.7l-0.1,40.5c0,5-1.8,6.4-8.6,6.7l0,4.4h35.1v-4.4 C516.7,127.4,514.4,126.1,514.4,121z"></path><path d="M573.2,57.3c-11,0-18.5,5.7-23.4,12.8V22.9h-2.7l-23.4,6.8v2.5l8.6,4.5V132h2.9l8-3.5c5.8,3.3,12.3,5,20.2,5 c20.8,0,37.4-15.8,37.4-42.6C600.9,69.9,590.4,57.3,573.2,57.3z M563.4,128.7c-5.4,0-10.3-2.4-13.7-7.9V73.6 c3.4-3.4,8.5-5.7,13.5-5.7c13.9,0,20,12.8,20,29.5C583.3,114.7,575.8,128.5,563.4,128.7z"></path><path d="M677,121.2V22.8h-2.6L651,29.6V32l8.6,4.5v25.7c-3.4-3.2-8.8-5.1-15.5-5.1c-19.9,0-35.2,15.3-35.2,41.3 c0,20.7,11.2,34.6,28.1,34.6c9.8,0,17-5.3,22.6-13.1v0.9V132h26.3l0-4.4C679.1,127.3,677,126.3,677,121.2z M659.6,117.1 L659.6,117.1c-3.4,3.4-8,5.1-13.2,5.1c-13.2,0-20.4-12.8-20.4-29.8c0-17.8,7.3-29.2,19.5-29.2c8.7,0,14.1,6.9,14.1,18.3 L659.6,117.1z"></path><path d="M747.1,121.1V79.3c0-15.8-9.4-22.4-26.6-22.4c-15,0-26.8,6.6-26.8,19.3c0,2.4,0.2,3.3,0.8,5h16.6 c-0.5-2-0.7-5-0.7-7.5c0-9.6,3.6-12.4,9.4-12.4c6.4,0,9.7,2,9.7,14.4v11.2l-20.8,7.7c-10.6,4.1-19.3,8.8-19.3,20.7 c0,10.9,7.5,17.8,18.6,17.8c9.9,0,17.4-6.2,21.9-12.1v-0.1h0.1l0,11.1l26,0.1v-4.5C749.3,127.1,747.1,126.2,747.1,121.1z M729.6,117.8c-4.4,3.3-7.6,5.3-12.1,5.4c-7.7,0-11.2-5.2-11.2-12.6c0-7.7,3.6-11.2,9.8-13.5l13.4-5.4L729.6,117.8L729.6,117.8z"></path></g><path d="M0,0v90.4c0,65.7,50.9,88.5,88.1,105.2h0.1l3,1.4c0.7-0.4,1.4-0.7,2.2-1c0.4-0.2,0.9-0.4,1.3-0.6 c37.3-16.6,88.4-39.5,88.4-105V0H0z M116,132l-2-5.3l-26.6-70c-1.6,4.1-5.3,14-9.3,24.6l-15.3,41.3c-0.7,2-0.3,3,0.2,3.7 c1.1,1.3,3.5,1.3,7.3,1.3H71l0,4.4H42.4l0-4.4h2.2c3.9,0,7.1-1.7,9.5-6.5l2.9-6.6l26.5-67.8l-4.7-12.5h24.7l34.1,89.7l3.1,8.1H116z"></path></svg></a>
<ul id="results-container" class="dropdown list-group"></ul>
<nav class="bd-links collapse" id="bd-docs-nav">
<div class="bd-toc-item">
<h4 class="bd-toc-link">Web API: Node</h4>
</div>

<div class="bd-toc-item ">
<a class="bd-toc-link" href="/web4node/sprint/reckzQd7ZgiFY5ok5">
1.&nbsp;&nbsp;Build a Web API
</a>
<ul class="nav bd-sidenav">

<li>
<a href="/web4node/module/recZiPP8Oyg1WlHxT/">
Introduction to Node.js and Express
</a>
</li>
<li>
<a href="/web4node/module/recBjiSulq0PYLCIj/">
Server-Side Routing with Express
</a>
</li>
<li>
<a href="/web4node/module/recCJjYFEz0i5O5p5/">
Express Middleware
</a>
</li>
<li>
<a href="/web4node/module/recs9QOkOAtZhsjc4/">
Web Deployment and Best Practices
</a>
</li>
</ul>
</div>
<div class="bd-toc-item ">
<a class="bd-toc-link" href="/web4node/sprint/receFLR7MpwQXesIN">
2.&nbsp;&nbsp;Adding Data Persistence
</a>
<ul class="nav bd-sidenav">

<li>
<a href="/web4node/module/recFG7SqlSCAB8iU7/">
Introduction to Relational Databases
</a>
</li>
<li>
<a href="/web4node/module/recIbfNn9xRhLTOv4/">
Database Schema Design
</a>
</li>
<li>
<a href="/web4node/module/recw2ezN22yjehidj/">
Multi-Table Queries
</a>
</li>
<li>
<a href="/web4node/module/rec5J23yAIdjmFbgP/">
Data Modeling
</a>
</li>
</ul>
</div>
<div class="bd-toc-item ">
<a class="bd-toc-link" href="/web4node/sprint/recGqGeZ7n75vZivn">
3.&nbsp;&nbsp;Authentication and Testing
</a>
<ul class="nav bd-sidenav">

<li>
<a href="/web4node/module/recQD9lnhqWEFh6g4/">
Introduction to Authentication
</a>
</li>
<li class="active bd-sidenav-active">
<a href="/web4node/module/reciCHdNjavSKaaLt/">
Using JSON Web Tokens (JWT)
</a>
</li>
<li>
<a href="/web4node/module/recd26oZ3GBNHh3Na/">
WEB Unit Testing
</a>
</li>
<li>
<a href="/web4node/module/reciXdxRA8zXJXDID/">
Testing the Back End
</a>
</li>
</ul>
</div>
<div class="bd-toc-item ">
<a class="bd-toc-link" href="/web4node/sprint/recWkcWui91eG1s8q">
4.&nbsp;&nbsp;WEB Unit 4 Node Build
</a>
<ul class="nav bd-sidenav">

</ul>
</div>
</nav>
</div>
</div>
<main class="content-container flex-wrapper" role="main">
<div class="sticky-nav">
<div class="sprint-nav">
<ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#prepare">Prepare</a></li>
<li class="toc-entry toc-h2"><a href="#learn">Learn</a></li>
<li class="toc-entry toc-h2"><a href="#guided-project">Guided Project</a></li>
<li class="toc-entry toc-h2"><a href="#project">Project</a></li>
<li class="toc-entry toc-h2"><a href="#review">Review</a></li>
</ul>
</div>

</div>
<div class="wrapper limit-width">
<div class="flex-wrapper">
<div class="limit-width">
<div class="jumbotron">
<h1 class="bd-title" id="content">Using JSON Web Tokens (JWT)</h1>
<span class="lead">
<p class="bd-lead"></p>
<p>In this module the student will build a full stack (an Express API and a React web application) authentication workflow using JSON Web Tokens.</p>
</span>
<strong>At the end of this module, you should be able to:</strong>
<ul>
<li>explain the three different parts of a JSON web token</li>
<li>produce and send a JSON Web Token (JWT)</li>
</ul>
</div>
<div class="alert alert-warning" role="alert">
<h4>Pro Tip</h4>
<p>Debugging is twice as hard as writing the code in the first place. Therefore, if you write the code as cleverly as possible, you are, by definition, not smart enough to debug it.</p>
<footer class="blockquote-footer"><p>Brian Kernighan</p>
</footer>
</div>
<h2 class="display-4">
<a id="prepare" class="anchor" href="#prepare" aria-hidden="true"><span class="octicon octicon-link"></span></a>Prepare</h2>
<p class="lead">Review each preclass resource before class.</p>
<div class="preclass">
<ul class="list-group list-group-flush">
<li class="list-group-item">
<div class="embed-responsive embed-responsive-16by9">
<iframe class="embed-responsive-item" src="https://www.youtube.com/embed/32NDCLaVnc4" frameborder="0" allowfullscreen></iframe>
</div>
</li>
<li class="list-group-item">
<div class="embed-responsive embed-responsive-16by9">
<iframe class="embed-responsive-item" src="https://www.youtube.com/embed/aPwDZDUpedA" frameborder="0" allowfullscreen></iframe>
</div>
</li>
<li class="list-group-item">
<a target="_blank" href="https://ponyfoo.com/articles/json-web-tokens-vs-session-cookies">JSON Web Tokens vs Sessions/Cookies</a>
</li>
<li class="list-group-item">
<a target="_blank" href="https://scotch.io/tutorials/the-anatomy-of-a-json-web-token">Anatomy of a JSON Web Token</a>
</li>
<li class="list-group-item">
<a target="_blank" href="https://jwt.io">jwt.io</a>
</li>
</ul>
</div>
<h2 class="display-4">
<a id="learn" class="anchor" href="#learn" aria-hidden="true"><span class="octicon octicon-link"></span></a>Learn</h2>
<h4 class="mark mb-3 p-2">Learn to explain the three different parts of a JSON web token</h4>
<p>We can use JSON web tokens (JWTs) to add authentication to a Web API. JSON web tokens are an industry standard for transferring data between two parties.</p>
<p>JWTs are cryptographically signed, typically using a secret with the HMACSHA-256 algorithm.</p>
<p>In this section we’ll look at the anatomy of a JWT.</p>
<h5>Overview</h5>
<p>JSON Web Tokens (JWT) are a way to transmit information between parties in the form of a JSON object. The JSON information is most commonly used for authentication and information exchange. In the former example, with authentication every JWT contains information. In the latter, JWTs contain the classic JSON data you’ve seen before.</p>
<p>Ultimately, a JWT is a string that has three parts separated by a period (<code class="highlighter-rouge">.</code>). Those are:</p>
<ul>
<li>The header.</li>
<li>The payload.</li>
<li>The signature.</li>
</ul>
<h3 id="header">Header</h3>
<p>The header contains the algorithm with the token type. Typically the header for a JWT looks like this.</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"alg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"HS256"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"typ"</span><span class="p">:</span><span class="w"> </span><span class="s2">"JWT"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p>the <code class="highlighter-rouge">alg</code> key specifies which algorithm was used to create the token, in this case, the algorithm is HMACSHA-256, and the <code class="highlighter-rouge">typ</code> property classifies this token as being of the type JWT.</p>
<h3 id="payload">Payload</h3>
<p>The payload includes <em>claims</em> (fancy name for things like permissions for the user) information or any other data we’d like to store in the token, which is most likely a user id. There are specific claims defined in the JWT standard, and you can also add custom properties to this object.</p>
<p>An example:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"sub"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1234567890"</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">standard</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="err">subject</span><span class="p">,</span><span class="w"> </span><span class="err">normally</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">user</span><span class="w"> </span><span class="err">id</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"John Doe"</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">custom</span><span class="w"> </span><span class="err">property</span><span class="w">
  </span><span class="nl">"iat"</span><span class="p">:</span><span class="w"> </span><span class="mi">1516239022</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">standard</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="err">The</span><span class="w"> </span><span class="err">Date</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">token</span><span class="w"> </span><span class="err">was</span><span class="w"> </span><span class="err">issued</span><span class="p">,</span><span class="w"> </span><span class="err">expressed</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">seconds</span><span class="w"> </span><span class="err">since</span><span class="w"> </span><span class="err">epoch.</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<h3 id="signature">Signature</h3>
<p>To create a signature, we must create a string by base64 encoding the header and payload together, and then signing it with a secret.</p>
<p>Combining all three parts, you will get a JWT that looks like this:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
</code></pre></div></div>
<h5>Follow Along</h5>
<p>Visit <a href="https://jwt.io/">this site</a> and click on the <code class="highlighter-rouge">Debugger</code> navigation link at the top to see an excellent representation of a JWT.</p>
<p>On the left-hand side, there is a sample JWT, and on the right, we can see the different parts highlighted in a different color to match the parts of the JWT string that represent those.</p>
<h5>Challenge</h5>
<p>Write a paragraph describing the parts of a JWT and send it to your PM on slack.</p>
<hr>
<h4 class="mark mb-3 p-2">Learn to produce and send a JSON Web Token (JWT)</h4>
<p>In this section we’ll use JSON Web Tokens to handle authentication in a Web API</p>
<h5>Overview</h5>
<p>In this section, we’ll use JSON Web Tokens to handle authentication.</p>
<p>To produce and verify the token, we’ll use the <code class="highlighter-rouge">jsonwebtoken</code> npm module.</p>
<h5>Follow Along</h5>
<p>Let’s produce and send a token on a successful login.</p>
<ul>
<li>add <code class="highlighter-rouge">jsonwebtoken</code> to the project and require it into <code class="highlighter-rouge">auth-router.js</code>.</li>
<li>change the <code class="highlighter-rouge">/login</code> endpoint inside the <code class="highlighter-rouge">auth-router.js</code> to produce and send the token.</li>
</ul>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ./auth/auth-router.js</span>

<span class="kd">const</span> <span class="nx">jwt</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">jsonwebtoken</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// installed this library</span>

<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/login</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="p">{</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">password</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>

  <span class="nx">Users</span><span class="p">.</span><span class="nx">findBy</span><span class="p">({</span> <span class="nx">username</span> <span class="p">})</span>
    <span class="p">.</span><span class="nx">first</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">user</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">user</span> <span class="o">&amp;&amp;</span> <span class="nx">bcrypt</span><span class="p">.</span><span class="nx">compareSync</span><span class="p">(</span><span class="nx">password</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">password</span><span class="p">))</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">generateToken</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span> <span class="c1">// new line</span>
 
        <span class="c1">// the server needs to return the token to the client</span>
        <span class="c1">// this doesn't happen automatically like it happens with cookies</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
          <span class="na">message</span><span class="p">:</span> <span class="s2">`Welcome </span><span class="p">${</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">}</span><span class="s2">!, have a token...`</span><span class="p">,</span>
          <span class="nx">token</span><span class="p">,</span> <span class="c1">// attach the token as part of the response</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">401</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Invalid Credentials</span><span class="dl">'</span> <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">json</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nx">generateToken</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">payload</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">subject</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="c1">// sub in payload is what the token is about</span>
    <span class="na">username</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
    <span class="c1">// ...otherData</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">expiresIn</span><span class="p">:</span> <span class="dl">'</span><span class="s1">1d</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// show other available options in the library's documentation</span>
  <span class="p">};</span>

  <span class="c1">// extract the secret away so it can be required and used where needed</span>
  <span class="k">return</span> <span class="nx">jwt</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">payload</span><span class="p">,</span> <span class="nx">secrets</span><span class="p">.</span><span class="nx">jwtSecret</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span> <span class="c1">// this method is synchronous</span>
<span class="p">}</span>
</code></pre></div></div>
<ul>
<li>add the <code class="highlighter-rouge">./config/secrets.js</code> file to hold the <code class="highlighter-rouge">jwtSecret</code>
</li>
</ul>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// the secrets will be safely stored in an environment variable, these are placeholders for development.</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">jwtSecret</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">JWT_SECRET</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">add a third table for many to many</span><span class="dl">'</span><span class="p">,</span>
<span class="p">};</span>
</code></pre></div></div>
<p>require <em>secrets.js</em> into <em>auth-router.js</em>: <code class="highlighter-rouge">const secrets = require('../config/secrets.js');</code></p>
<ul>
<li>Login with the student/hired user and show the token.</li>
<li>Review the steps taken one more time.</li>
</ul>
<p>We have a server that can produce and send JWTs on a successful login.</p>
<h5>Challenge</h5>
<p>Implement login using JWTs</p>
<hr>
<h2>
<a id="guided-project" class="anchor" href="#guided-project" aria-hidden="true"><span class="octicon octicon-link"></span></a>Guided Project</h2>
<h3>Node Auth 2 Guided Project</h3>
<p>Starter code for Node Auth 2 guided project</p>
<a target="_blank" href="https://github.com/LambdaSchool/node-auth2-guided">GitHub Repo</a>
<hr>
<h2 class="display-4">
<a id="project" class="anchor" href="#project" aria-hidden="true"><span class="octicon octicon-link"></span></a>Project</h2>
<ul class="list-group">
<li class="list-group-item">
<h5><a target="_blank" href="https://github.com/LambdaSchool/node-auth2-project">Node Auth 2 Project</a></h5>
</li>
</ul>
<h2 class="display-4">
<a id="review" class="anchor" href="#review" aria-hidden="true"><span class="octicon octicon-link"></span></a>Review</h2>
<h3 class="display-5">Class Recordings</h3>
<p class="lead">You can use class recordings to help you master the material.</p>
<div>
<ul class="list-group list-group-flush">
<li class="list-group-item">
<strong><a target="_blank" href="https://youtu.be/BRlElXWj1cQ">Using JSON Web Tokens (JWT) for Web PT 18 w/Jason Maurer</a></strong>
<p>In this module the student will build a full stack (an Express API and a React web application) authentication workflow using JSON Web Tokens. At the end of this module, you should be able to: explain the three different parts of a JSON web token produce and send a JSON Web Token (JWT)</p>
</li>
<li class="list-group-item">
<a href="/archive/FSW/module/reciCHdNjavSKaaLt">All previous recordings</a>
</li>
</ul>
</div>
<h3 class="display-5">Demonstrate Mastery</h3>
<p>To demonstrate mastery of this module, you need to complete and pass a code review on each of the following:</p>
<ul>
<li>Objective challenge: <p>Write a paragraph describing the parts of a JWT and send it to your PM on slack.</p>
</li>
<li>Objective challenge: <p>Implement login using JWTs</p>
</li>

<li>Guided Project: Node Auth 2 Guided Project</li>
<li>Project: Node Auth 2 Project</li>
<li>Code Challenge: RandSevenToRandFive</li>
<li>Code Challenge: OverlappingRectangles</li>
</ul>
</div>
</div>
</div>
</main>
</div>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-80850900-4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'UA-80850900-4');
</script>
<script type="text/javascript">
  function getDomain() {
    const domainName = window.location.hostname.split('.')[1];
    return `${domainName}.com`;
  }
</script>
<script src="" integrity="" crossorigin="anonymous"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
<script src="/assets/js/vendor/popper.min.js" integrity="" crossorigin="anonymous"></script><script src="/dist/js/bootstrap.min.js" integrity="" crossorigin="anonymous"></script><script src="/assets/js/activate.js"></script>
<script src="/assets/js/jekyll-search.js" type="text/javascript"></script>
<script type="text/javascript">
  SimpleJekyllSearch.init({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('results-container'),
    dataSource: '/search.json',
    searchResultTemplate: '<li class="list-group-item"><a href="{url}" title="Using JSON Web Tokens (JWT)">{title}</a></li>',
    noResultsText: '',
    limit: 10,
    fuzzy: true,
  })
</script>
<script src="/assets/js/mermaid.min.js"></script><script type="text/javascript">
  if (window.attachEvent) {
    window.attachEvent('onload', verifySignedIn);
  } else {
    if (window.onload) {
      var currentOnLoadFn = window.onload;
      var newOnLoadFn = function (evt) {
        currentOnLoadFn(evt);
        verifySignedIn();
      };
      window.onload = newOnLoadFn;
    } else {
      window.onload = verifySignedIn;
    }
  }

  function verifySignedIn() {
    if (isPagePublic()) {
      return showPageContents();
    }

    window.__user = null;
    isSignedIn().then((user) => {
      window.__user = user;

      if (!user.signedIn) {
        redirectToSignIn();
      } else if (!user.student && !window.__openToAdmissions) {
        showUnauthorizedMessage();
      } else {
        showPageContents();
      }
    });
  }

  function isPagePublic() {
    const openCourses = [
      'and-pre',
      'ds-pre',
      'fsw-pre',
      'help',
      'ios-pre',
    ];

    const openPages = [
      'cs-and',
      'cs-fsw',
      'cs-ios',
      'cr',
      'ds',
      'jx',
      'p4s',
      'ux',
    ];

    const pathParts = window.location.pathname.split('/');
    const courseName = pathParts[1];
    const pageName = pathParts[pathParts.length - 1];

    return openCourses.includes(courseName) || openPages.includes(pageName);
  }

  function isSignedIn() {
    const isDeployPreview = window.location.hostname.startsWith('deploy-preview') && window.location.hostname.endsWith('netlify.com');

    if (isDeployPreview) return Promise.resolve({ signedIn: true, student: true });

    return fetch(`${getAuthBaseUrl()}/whoami`, { credentials: 'include' })
      .then((response) => response.text())
      .then((userAsText) => userAsText ? JSON.parse(userAsText) : null)
      .then((userData) => ({ signedIn: Boolean(userData), student: Boolean(userData && userData.airtableId), id: userData ? userData.id : null, email: userData ? userData.email : null }))
      .catch((error) => {});
  }

  function redirectToSignIn() {
    const signInUrl = `${getAuthBaseUrl()}/sign-in?redirect=${encodeURIComponent(window.location.href)}&reason=auth_required`
    const redirectMessage = document.querySelector('#redirect-message');
    redirectMessage.style.display = "block";
    redirectMessage.innerHTML = `<div>You are being redirected to the sign in page. If you aren't redirected automatically, you can use <a href=${signInUrl}>this link</a>.</div>`
    window.location = signInUrl;
  }

  function showPageContents() {
    document.querySelector('#content-wrapper').style.visibility = 'visible';
  }

  function showUnauthorizedMessage() {
    document.querySelector('#unauthorized-message').style.display = 'block';
  }

  function getAuthBaseUrl() {
    const domain = getDomain();
    const authBaseUrl = `https://auth.${domain}`;
    return authBaseUrl;
  }
</script><script src="/assets/js/docs.min.js"></script><script>
  var MathJax = {
    tex: {
      inlineMath: [['$$', '$$'], ['\[', '\])']]
    },
    "HTML-CSS": {
      styles: {
        ".MathJax span": {
          color: "#000000"
        }
      }
    }
  }
</script>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
<script>
  handleExternalLinks();

  function handleExternalLinks() {
    const domain = getDomain();
    const links = document.querySelectorAll('a');
    return links.forEach((link) => {
      if (!link.host.includes(domain)) link.target = '_blank';
    })
  };
</script>
</div>
</body>
</html>
